//#RequireContext CSmMode
#Extends "Modes/TrackMania/TM_Rounds_Online.Script.txt"

#Include "TextLib" as TextLib
#Include "MathLib" as MathLib
#Include "ColorLib" as ColorLib

#Include "Libs/TMKart/Effects.Script.txt" as Effects
#Include "Libs/TMKart/UI/GameUI.Script.txt" as GameUI

#Setting S_TrustClientSimu True
#Setting S_UseCrudeExtrapolation False
#Setting S_AutoSpecTimeout 300 as _("Idle Time before player is AutoSpeced")

/////////////
// Structs //
/////////////


///////////
// Plugs //
///////////

***Match_StartServer***
***
UsePvECollisions = True;
UsePvPCollisions = True;
Effects::InitEffects();
***

***Match_PlayLoop***
***

foreach (Player in Players) {
    if (Player.IdleDuration >= S_AutoSpecTimeout * 1000 && S_AutoSpecTimeout >= 9 && Player.RequestsSpectate == False) {
        ServerAdmin.ForceSpectator(Player.User, CServerAdmin::ESpecMode::SpectatorSelectable);
        UIManager.GetUI(Player).SendChat("$z$ee0$s[$fffServer$ee0] You have been automatically sent to spectator.$z");
    }
}

Effects::Yield();
***

***Match_InitMap***
***
Effects::CleanUp();
GameUI::SyncLaps();
***

***Match_InitMatch***
***
Effects::CleanUp();
***

***Match_InitRound***
***
Effects::CleanUp();
***

Void doNothing() {

}